/* dialog 2014-08-15
 * version: 0.1.0
 * @author: zhangchen2397@126.com
 */
!function(a,b){"function"==typeof define?define("dialog",["jqmobi"],function(c){return b(a,c)}):a.dialog=b(a,a.$)}(window,function(a,b){var c={mask:'<div class="dialog-mask"></div>',dialog:['<div class="#{dialogClass}" id="#{dialogId}">','<div class="hd">','<span class="close">X</span>',"#{title}","</div>",'<div class="bd">#{content}</div>','<div class="ft">','<span class="btn btn-ok">#{btnOk}</span>','<span class="btn btn-cancel">#{btnCancel}</span>',"</div>","</div>"].join("")},d=0,e=function(a){this.defaultConfig={dialogId:"dialog",dialogClass:"dialog",type:"confirm",showMask:!0,showCloseBtn:!1,autoShow:!1,content:"",title:"",btnOk:"确定",btnCancel:"取消",clickBtnOkCb:null,clickBtnCancelCb:null},this.config=b.extend(this.defaultConfig,a||{}),this.config.dialogId+="-"+b.uuid(),d++,this.init.call(this)};return b.extend(e.prototype,{init:function(){var a=this.config;this.hasInit||(this.hasInit=!0,this._createDom(),this._cacheDom(),this._initEvent()),this.setPos(),this.hide(),a.autoShow&&this.show()},_createDom:function(){var a=this.config,e=b(document.body);2>d&&e.append(c.mask),e.append(this.format(c.dialog,a))},_cacheDom:function(){var a=this.config,c=null;this.el=b("#"+a.dialogId),c=this.el,this.hd=c.find(".hd"),this.bd=c.find(".bd"),this.ft=c.find(".ft"),this.closeBtn=c.find(".close"),this.mask=b(".dialog-mask"),this.btnOk=c.find(".btn-ok"),this.btnCancel=c.find(".btn-cancel"),"alert"==a.type?this.btnCancel.hide():"normal"==a.type&&this.ft.hide(),!a.title&&this.hd.hide(),!a.showCloseBtn&&this.closeBtn.hide()},_initEvent:function(){var a=this.config,c=a.clickBtnOkCb?a.clickBtnOkCb:this.hide,d=a.clickBtnCancelCb?a.clickBtnCancelCb:this.hide;this.btnOk.bind("click",b.proxy(c,this)),this.btnCancel.bind("click",b.proxy(d,this)),this.closeBtn.bind("click",b.proxy(this.hide,this)),b(window).bind("resize",b.proxy(this.setPos,this)),b(window).bind("orientationchange",b.proxy(this.setPos,this))},show:function(){return b.trigger(this,"beforeShow"),this.mask.show(),this.el.show(),b.trigger(this,"afterShow"),this},hide:function(){return b.trigger(this,"aftershow"),this.mask.hide(),this.el.hide(),b.trigger(this,"afterHide"),this},setPos:function(){var a=this.config,c=b(window).height(),d=b(window).height(),e=b(window).width(),f=this.el.height(),g=this.el.width();return a.showMask&&this.mask.css("height",c+"px"),this.el.css({top:(d-f)/2+"px",left:(e-g)/2+"px"}),this},format:function(a,b){return a=String(a),a.replace(/#\{(.+?)\}/g,function(a,c){var d=b[c];return"undefined"==typeof d?"":d})}}),{dialog:e,createDialog:function(a){return new e(a)},createConfirmDialog:function(a){return a.type="confirm",new e(a)},createAlertDialog:function(a){return a.type="alert",new e(a)},createNormalDialog:function(a){return a.type="normal",new e(a)}}});